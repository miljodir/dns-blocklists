name: Update Blocklist

on:
  workflow_dispatch:
  schedule:
    - cron: '0 2 * * *' # Runs daily at 2:00 UTC

jobs:
  update-blocklist:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Download blocklist
        run: |
          curl -sSL https://raw.githubusercontent.com/hagezi/dns-blocklists/main/wildcard/pro.mini-onlydomains.txt -o blocklist.txt

      - name: Remove first 11 lines
        run: |
          tail -n +12 blocklist.txt > pro.mini-onlydomains.txt

      - name: Commit and push changes
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add pro.mini-onlydomains.txt
          git commit -m "Update processed blocklist"
          git push

  dispatch-auto:
    needs: [update-blocklist]
    runs-on: ubuntu-latest
    steps:
    - name: Repository Dispatch
      uses: peter-evans/repository-dispatch@v2
      with:
        event-type: blocklist-updated
        client-payload: '{"ref": "${{ github.ref }}", "sha": "${{ github.sha }}"}'